name: Update README with Website Statuses

on:
  schedule:
    - cron: '*/5 * * * *'
  workflow_dispatch:
  push:
    branches: ['master', 'main']

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Check website status
        id: check_websites
        run: |
          sites=(
            "mw.lonelil.ru"
            "watch.qtchaos.de"
            "bmov.vercel.app"
            "stream.thehairy.me"
            "movie-web-me.vercel.app"
            "scootydooter.vercel.app"
            "sudo-flix.lol"
          )
          echo '# Movie-Web Instances Statuses' > README.md
          for site in "${sites[@]}"; do
            status_code=$(curl --write-out %{http_code} --silent --output /dev/null --max-time 7 "https://$site")
            if [ $status_code -eq 200 ]; then
              echo "$site: ðŸŸ¢" >> README.md
            else
              echo "$site: ðŸ”´" >> README.md
            fi
            echo >> README.md
          done

      - name: Commit and push if changed
        run: |
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'actions@github.com'
          git add README.md
          git diff --staged --quiet || git commit -m "Update README with Movie-Web Instances Statuses"
          git push
